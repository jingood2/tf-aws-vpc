on:
  pull_request:
    types:
      - closed

jobs:
  apply-dev-plan:
    uses: jingood2/tf-template/.github/workflows/apply-tf-plan.yml@main
    with:
      path: tfplan
      gh_environment: dev
      tf_version: 1.3.0
    secrets:
      terraform_api_token: ${{ secrets.TF_API_TOKEN }}

  apply-stage-plan:
    needs: apply-dev-plan
    uses: jingood2/tf-template/.github/workflows/apply-tf-plan.yml@main
    with:
      path: tfplan
      gh_environment: stage
      tf_version: 1.3.0
    secrets:
      terraform_api_token: ${{ secrets.TF_API_TOKEN }}

  apply-prod-plan:
    needs: apply-stage-plan
    uses: jingood2/tf-template/.github/workflows/apply-tf-plan.yml@main
    with:
      path: tfplan
      gh_environment: prod
      tf_version: 1.3.0
    secrets:
      terraform_api_token: ${{ secrets.TF_API_TOKEN }}